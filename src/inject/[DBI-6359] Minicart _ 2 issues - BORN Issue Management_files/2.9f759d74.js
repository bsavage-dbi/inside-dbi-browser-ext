(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{690:function(e,t,n){"use strict";var r=n(35),a=n(207),o=n(79),i=n(57);function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){d(o,r,a,i,c,"next",e)}function c(e){d(o,r,a,i,c,"throw",e)}i(void 0)}))}}var h={"Content-Type":"application/json"},m=!1,g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return"AUTHENTICATION_FAILED"===e.code?i.a.warning({title:"Session expired",body:"Please reload this page or generate new slack configuration link"}):b(e,t)},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;r.a(e),m=!0;var n={jira:"Jira",slack:"Slack"}[e.source]||"Slack integration",a="".concat(n," error: something went wrong while ").concat(t),o=["Please try again later or contact support."];return e.reqId&&o.push("Error ID: ".concat(e.reqId)),i.a.error({title:a,body:o.join(" ")})};function w(e){return v.apply(this,arguments)}function v(){return(v=f(regeneratorRuntime.mark((function e(t){var n,r,a,c,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:{},!m){e.next=3;break}return e.abrupt("return");case 3:return r=n.headers||h,a=n.body&&JSON.stringify(n.body),e.next=7,Object(i.e)();case 7:return(c=e.sent)&&(r["Slack-Token"]=c),e.next=11,Object(i.b)();case 11:return r.Authorization=e.sent,e.abrupt("return",Object(o.d)(t,p(p({},n),{},{headers:r,body:a})));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=f(regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(i.e)();case 2:if(!(t=e.sent)){e.next=23;break}if((n=Object(a.a)(t).sub).instanceId){e.next=10;break}return e.next=8,j(n.channel.id);case 8:return o=e.sent,e.abrupt("return",{channel:p(p({},n.channel),o)});case 10:return e.prev=10,e.next=13,w("/api/connections",{method:"POST"});case 13:return e.abrupt("return",e.sent);case 16:if(e.prev=16,e.t0=e.catch(10),"NONCE_INVALID"!==e.t0.code){e.next=20;break}return e.abrupt("return",null);case 20:g(e.t0,"creating connection");case 21:e.next=24;break;case 23:r.b("No slack token found in Addon");case 24:case"end":return e.stop()}}),e,null,[[10,16]])})))).apply(this,arguments)}function k(){return(k=f(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w("/api/subscriptions/".concat(t),{method:"PATCH",body:{options:n}});case 3:e.next=12;break;case 5:if(e.prev=5,e.t0=e.catch(0),"PERMISSION_DENIED"!==e.t0.code){e.next=9;break}return e.abrupt("return",i.a.warning({title:"Permission denied",body:e.t0.message}));case 9:if("INVALID_JQL"!==e.t0.code){e.next=11;break}return e.abrupt("return",i.a.error({title:"Invalid JQL",body:"Could not save project connection settings"}));case 11:g(e.t0,"updating project connections");case 12:return e.abrupt("return",i.a.success({title:"Project connection settings saved",body:""}));case 13:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function I(){return(I=f(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w("/api/subscriptions",{method:"POST",body:t});case 3:return n=e.sent,r=n.subscription,e.abrupt("return",r);case 8:if(e.prev=8,e.t0=e.catch(0),"PERMISSION_DENIED"!==e.t0.code){e.next=12;break}return e.abrupt("return",i.a.warning({title:"Permission denied",body:e.t0.message}));case 12:g(e.t0,"creating project connection");case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function O(){return(O=f(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w("/api/subscriptions/".concat(t),{method:"DELETE"});case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),"PERMISSION_DENIED"===e.t0.code?i.a.warning({title:"Permission denied",body:e.t0.message}):g(e.t0,"deleting project connections"),e.t0;case 9:i.a.success({title:"Project connection deleted",body:""});case 10:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function x(){return(x=f(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new URL("/api/slack/login","https://".concat(window.location.hostname)),r=window.location.pathname.split("/"),a=c(r,2),o=a[1],n.searchParams.set("source",["jira",o,t].filter(Boolean).join("-")),e.t0=n.searchParams,e.next=6,Object(i.b)();case 6:return e.t1=e.sent,e.t0.set.call(e.t0,"addonToken",e.t1),e.abrupt("return",n.toString());case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return w("/api/channels/".concat(e)).then((function(e){return e.channel})).catch((function(e){return g(e,"getting channel info")}))}function E(){return(E=f(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w("/api/instances",{method:"PATCH",body:t});case 3:e.next=11;break;case 5:if(e.prev=5,e.t0=e.catch(0),"PERMISSION_DENIED"!==e.t0.code){e.next=10;break}return i.a.warning({title:"Permission denied",body:"You have no permissions to manage global addon settings."}),e.abrupt("return");case 10:g(e.t0,"updating instance");case 11:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function P(){return(P=f(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w("/api/channels/linked?issueId=".concat(t,"&projectId=").concat(n));case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),g(e.t0,"getting channel for issue");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function S(){return(S=f(regeneratorRuntime.mark((function e(t){var n,r,a,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.issueId,r=t.projectId,a=t.channelName,o=t.members,c=t.private,e.prev=1,e.next=4,w("/api/channels/linked",{method:"POST",body:{issueId:n,projectId:r,channelName:a,members:o,isPrivate:c}});case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),"ISSUE_ALREADY_LINKED"!==e.t0.code){e.next=12;break}throw i.a.warning({title:"This issue is already linked to a Slack channel",body:"Sorry, we couldn't create that channel because the issue is already linked to one"}),e.t0;case 12:if(!["NAME_ALREADY_TAKEN","MISSING_SCOPE"].includes(e.t0.code)){e.next=14;break}throw e.t0;case 14:return e.abrupt("return",g(e.t0,"creating channel for issue"));case 15:case"end":return e.stop()}}),e,null,[[1,7]])})))).apply(this,arguments)}function R(){return(R=f(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new URL("/api/slack/users/login","https://".concat(window.location.hostname)),t&&n.searchParams.set("team",t),e.t0=n.searchParams,e.next=5,Object(i.b)();case 5:return e.t1=e.sent,e.t0.set.call(e.t0,"addonToken",e.t1),e.abrupt("return",n.toString());case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=f(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w("/api/slack/users").catch((function(e){return g(e,"getting slack users list"),[]})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=f(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w("/api/slack/users",{method:"DELETE",body:{teamId:t}}).catch((function(e){return g(e,"deleting slack users")})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return(N=f(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w("api/features",{method:"POST",body:t});case 3:return n=e.sent,e.abrupt("return",n);case 7:e.prev=7,e.t0=e.catch(0),g(e.t0,"loading page");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}t.a={getFeatureFlags:function(e){return N.apply(this,arguments)},connections:{create:function(){return y.apply(this,arguments)}},subscriptions:{list:function(e){var t=e.projectId,n=e.channelId,r="/api/subscriptions";return t&&(r+="?projectId=".concat(t)),n&&(r+="?channelId=".concat(n)),w(r).then((function(e){return e.subscriptions})).catch((function(e){return g(e,"getting project connection list"),[]}))},update:function(e,t){return k.apply(this,arguments)},create:function(e){return I.apply(this,arguments)},delete:function(e){return O.apply(this,arguments)}},teams:{loginUrl:function(e){return x.apply(this,arguments)},list:function(){return w("/api/teams").then((function(e){return e.teams})).catch((function(e){return g(e,"getting teams list"),[]}))}},channels:{list:function(e){return w("/api/channels?teamId=".concat(e)).then((function(e){return e.channels})).catch((function(e){return g(e,"getting channels list"),[]}))},show:j,update:function(e){return w("/api/channels/".concat(e.id),{method:"PATCH",body:e}).catch((function(e){return g(e,"updating channel")}))}},instances:{show:function(){return w("/api/instances").catch((function(e){return g(e,"getting instance info")}))},update:function(e){return E.apply(this,arguments)}},issueMentions:{list:function(e,t){return w("/api/issueMentions?issueId=".concat(e,"&limit=").concat(t||"")).catch((function(e){return console.warn("Failed to retrieve the issue mentions list",e),{}}))},getLink:function(e){return w("/api/issueMentions/link?issueMentionId=".concat(e)).catch((function(e){return g(e,"getting issue mention link")}))}},issueChannel:{get:function(e,t){return P.apply(this,arguments)},create:function(e){return S.apply(this,arguments)}},slackUsers:{loginUrl:function(e){return R.apply(this,arguments)},list:function(){return A.apply(this,arguments)},listInWorkspace:function(){return w("/api/slack/proxy/users.list").catch((function(e){return g(e,"getting slack users in workspace")}))},delete:function(e){return D.apply(this,arguments)}}}},707:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(37),a=n(57),o=n(755),i=n(197);function c(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){c(o,r,a,i,u,"next",e)}function u(e){c(o,r,a,i,u,"throw",e)}i(void 0)}))}}function s(e){var t=e.children,n=e.onComplete,r=e.url;function c(e){var t=e.errorCode,r=e.errorMessage,o=e.reqId;if(t&&"ACCESS_DENIED"!==t){var i=r||"Please try again later or contact support.";return a.a.error({body:"".concat(i," Error ID: ").concat(o)})}n()}function s(){var e=o.a.getItem("OAuthWindowParams");e&&(window.removeEventListener("storage",s),o.a.removeItem("OAuthWindowParams"),c(JSON.parse(e)))}function p(){return(p=u(regeneratorRuntime.mark((function e(){var t,n,a,u,p,l,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=parseInt(window.outerWidth,10),n=parseInt(window.outerHeight,10),a=parseInt(window.screenX,10),u=parseInt(window.screenY,10),450,645,p=Math.round((t-450)/2+a),l=Math.round((n-645)/3+u),d={width:450,height:645,left:p,top:l,toolbar:0,menubar:0,location:0,status:0,scrollbars:1,resizable:0,chrome:"yes"},f=Object.keys(d).map((function(e){return"".concat(e,"=").concat(d[e])})).join(","),o.a.removeItem("OAuthWindowParams"),window.addEventListener("storage",s),i.a.sendScreenEvent({name:"oAuthScreen"}),window._OAuthWindowCallback=c,e.t0=window,e.next=17,r;case 17:e.t1=e.sent,e.t2=f,e.t0.open.call(e.t0,e.t1,"Authenticate",e.t2);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return t({onClick:function(){return p.apply(this,arguments)}})}s.propTypes={children:r.func.isRequired,onComplete:r.func.isRequired,url:Object(r.oneOfType)([r.string,Object(r.instanceOf)(Promise)]).isRequired}},755:function(e,t,n){"use strict";t.a={getItem:function(e){try{return window.localStorage.getItem(e)}catch(e){this._handleError(e)}},setItem:function(e,t){var n=!1;try{window.localStorage.setItem(e,t),n=!0}catch(e){this._handleError(e)}return n},removeItem:function(e){var t=!1;try{window.localStorage.removeItem(e),t=!0}catch(e){this._handleError(e)}return t},_handleError:function(e){console.warn("Looks like you've disabled local storage, enable it to avoid this warning",e)}}}}]);
//# sourceMappingURL=2.9f759d74.js.map